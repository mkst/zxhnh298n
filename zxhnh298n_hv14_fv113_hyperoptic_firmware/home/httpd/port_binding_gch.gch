<%IMPORT FILE "common_gch.gch";var FP_OBJNAME = "OBJ_PORT_BINDING_ID";var FP_PARANUM = 3;var FP_IDENTITY = "";var FP_ERRORSTR = "SUCC";var FP_HANDLE, FP_ID;var PARA[3] ={"WANViewName","LANViewName","Enable"};function getIndex(){var FP_INDEX = request("IF_INDEX");if (FP_INDEX IS NULL){if ( 0 == getenv("DevIPv6Effect") ){var identity = "";var IpMode = "";var FP_INSTNUM = query_list("OBJ_LISTWANC_ID", "binding");if(FP_INSTNUM >= 1 && FP_INSTNUM != 888){for(var i = 0; i < FP_INSTNUM; i++ ){identity = query_identity(i);IpMode = get_IPMode(identity);if (IpMode != "2"){return i;}}}}return 0;}return FP_INDEX;}var FP_INDEX = getIndex();var FP_ACTION = request("IF_ACTION");var FP_LAN_INSTNUM = query_list("OBJ_WANLAN_ID", "IGD");var LAN_HANDLE = null;var LAN_BRType = null;var LAN_identity = "";var LAN_WANLANType = null;var FP_INSTNUM=0;if(FP_LAN_INSTNUM >= 1 && FP_LAN_INSTNUM != 888){for(var i = 0; i < FP_LAN_INSTNUM; i++ ){LAN_HANDLE = create_paralist();LAN_identity = query_identity(i);get_inst(LAN_HANDLE, "OBJ_WANLAN_ID", LAN_identity);LAN_BRType = get_para(LAN_HANDLE, "BRType");LAN_WANLANType = get_para(LAN_HANDLE, "WANLANType");if(LAN_BRType == "0"&& LAN_WANLANType == "2"){++FP_INSTNUM;}destroy_paralist(LAN_HANDLE);}}if (FP_ACTION == "apply"){for (var j=0; j<FP_INSTNUM; j++){FP_HANDLE = create_paralist();query_list("OBJ_LISTWANC_ID", "binding");FP_IDENTITY = query_identity(FP_INDEX);for(var i=0; i< FP_PARANUM; i++){set_multiinst_para(FP_HANDLE, PARA[i], j);}FP_IDENTITY = set_inst(FP_HANDLE, FP_OBJNAME, FP_IDENTITY);}}create_form_start("fSubmit", "");createHigherHidden(FP_INDEX);if (0 == FP_INSTNUM)create_hidden_para(FP_HANDLE, PARA, FP_PARANUM);var j=0;for(var i = 0; i < FP_LAN_INSTNUM; i++ ){FP_HANDLE = create_paralist();FP_LAN_INSTNUM = query_list("OBJ_WANLAN_ID", "IGD");LAN_identity = query_identity(i);get_inst(FP_HANDLE, "OBJ_WANLAN_ID", LAN_identity);LAN_BRType = get_para(FP_HANDLE, "BRType");LAN_WANLANType = get_para(FP_HANDLE, "WANLANType");if(LAN_BRType == "0"&& LAN_WANLANType == "2"){var wannum = query_list("OBJ_LISTWANC_ID", "binding");var dslitenum = 0;dslitenum = query_list("OBJ_TUNNEL_ID", "IGD");var index1 = (FP_INDEX-wannum);var index2 = (FP_INDEX-wannum -dslitenum);if(index1 >=0 && index2 <0){query_list("OBJ_TUNNEL_ID", "IGD");FP_IDENTITY = query_identity(index1);set_para(FP_HANDLE, "WANViewName", FP_IDENTITY);}else if(index2 >=0){query_list("OBJ_6IN4TUNL_ID", "IGD");FP_IDENTITY = query_identity(index2);set_para(FP_HANDLE, "WANViewName", FP_IDENTITY);}else if(index1 < 0){query_list("OBJ_LISTWANC_ID", "binding");FP_IDENTITY = query_identity(FP_INDEX);set_para(FP_HANDLE, "WANViewName", FP_IDENTITY);}set_para(FP_HANDLE, "LANViewName", LAN_identity);qeury_list_bycond(FP_OBJNAME, "IGD", FP_HANDLE);create_hidden_multiinstpara(FP_HANDLE, PARA, j, FP_PARANUM);j++;}destroy_paralist(FP_HANDLE);}getDisplayInstError(FP_ERRORSTR);set_hidden("IF_INSTNUM", FP_INSTNUM);create_form_end();%>